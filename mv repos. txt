
Il prend un seul argument : le fichier texte contenant la liste des serveurs.
Pour chaque serveur, il se connecte en SSH et d√©place tous les fichiers de /etc/yum.repos.d/ vers /etc/yum.repos.d/arc/.


---

Script simple ‚Äî move_repo_files.sh

#!/bin/bash

# V√©rifie qu'un fichier liste des serveurs est fourni
if [ -z "$1" ]; then
  echo "Usage: $0 liste_serveurs.txt"
  exit 1
fi

SERVER_LIST="$1"

# V√©rifie que le fichier existe
if [ ! -f "$SERVER_LIST" ]; then
  echo "Erreur : fichier '$SERVER_LIST' introuvable."
  exit 1
fi

# Boucle sur chaque serveur
while read -r SERVER; do
  # Ignore les lignes vides ou commentaires
  [[ -z "$SERVER" || "$SERVER" =~ ^# ]] && continue

  echo "==> Connexion √† $SERVER ..."

  ssh "$SERVER" "sudo mkdir -p /etc/yum.repos.d/archive && \
                 sudo mv -v /etc/yum.repos.d/*.repo /etc/yum.repos.d/arc/ 2>/dev/null || echo 'Aucun fichier √† d√©placer'"

done < "$SERVER_LIST"

echo "D√©placement termin√© sur tous les serveurs."


---

Exemple de fichier serveurs.txt

# Liste des serveurs RHEL
rhel-app-01
rhel-db-02
192.168.10.15


---

 Utilisation
chmod +x move_repo_files.sh
./move_repo_files.sh serveurs.txt


---

Ce que fait le script

Cr√©e le dossier /etc/yum.repos.d/arc s‚Äôil n‚Äôexiste pas d√©j√†.

D√©place tous les fichiers .repo du dossier /etc/yum.repos.d/ vers arc/.

Ignore les serveurs vides ou c


Parfait üëç ta capture montre que le script fonctionne bien ‚Äî il s‚Äôex√©cute jusqu‚Äôau bout et affiche :

> Aucun fichier √† d√©placer



Cela veut simplement dire qu‚Äôil n‚Äôy avait aucun fichier .repo √† d√©placer dans /etc/yum.repos.d/ sur ce serveur.


---

üîç D√©tails de l‚Äôerreur affich√©e

mv: cannot stat '/etc/yum.repos.d/*.repo': No such file or directory
Aucun fichier √† d√©placer

Traduction : la commande mv n‚Äôa trouv√© aucun fichier correspondant √† *.repo.
C‚Äôest normal et sans gravit√© ‚Äî √ßa veut dire que :

soit le r√©pertoire /etc/yum.repos.d/ est vide,

soit les fichiers .repo ont d√©j√† √©t√© d√©plac√©s,

soit les d√©p√¥ts sont g√©r√©s autrement (par Satellite, par exemple via redhat.repo automatique).



---

Pour ne plus afficher ce message ¬´ mv: cannot stat ¬ª

Tu peux l√©g√®rement modifier le script pour √©viter l‚Äôerreur et n‚Äôafficher que ‚ÄúAucun fichier √† d√©placer‚Äù quand il n‚Äôy a rien :

#!/bin/bash

if [ -z "$1" ]; then
  echo "Usage: $0 liste_serveurs.txt"
  exit 1
fi

LISTE_SERVEURS="$1"

while read -r SERVEUR; do
  [ -z "$SERVEUR" ] && continue
  [[ "$SERVEUR" =~ ^# ]] && continue

  echo "Connexion √† $SERVEUR ..."
  ssh "$SERVEUR" '
    mkdir -p /etc/yum.repos.d/archive
    shopt -s nullglob
    FILES=(/etc/yum.repos.d/*.repo)
    if [ ${#FILES[@]} -eq 0 ]; then
      echo "Aucun fichier √† d√©placer"
    else
      mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/archive/
      echo "Fichiers d√©plac√©s vers archive/"
    fi
  '
done < "$LISTE_SERVEURS"

echo "‚úÖ D√©placement termin√© sur tous les serveurs."


---

R√©sum√©

Le script fonctionne : il boucle sur tes serveurs.

Message mv: cannot stat = aucun fichier .repo trouv√© ‚Üí pas une erreur bloquante.

La version ci-dessus masque ce message et affiche simplement un texte clair.


Souhaites-tu que je t‚Äôajoute une ligne pour v√©rifier et afficher les fichiers d√©plac√©s sur chaque serveur (ex : ls /etc/yum.repos.d/archive apr√®s le d√©placement) ?